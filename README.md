# 6軸力覚センサ データロガー & プロッター

Leptrino製6軸力覚センサ「SFS100F501M500U6」のデータをPCで記録し、グラフ化するためのWindowsアプリケーションです。

## 主な機能

### データ記録・保存
- 6軸力覚データ（Fx, Fy, Fz, Mx, My, Mz）の高速記録
- 記録データをタイムスタンプ付きのCSVファイルとして保存
- 計測データの統計情報（平均サンプリングレートなど）を表示

### グラフ表示
- **リアルタイムプロット**: 計測中に力とモーメントを別々のウィンドウでリアルタイム表示
  - 力データ専用ウィンドウ（Fx, Fy, Fz）
  - モーメントデータ専用ウィンドウ（Mx, My, Mz）
  - 1つのボタンで両方のウィンドウを同時制御
- **記録後プロット**: 記録完了後、力とモーメントを別々のウィンドウでgnuplotによる高品質グラフ表示

### パフォーマンス最適化
- 計測処理とリアルタイム表示処理の完全分離
- データ間引き機能による表示負荷軽減
- 高速記録を優先した設計

## 必要なもの

### ハードウェア・ソフトウェア
- **OS**: Windows 10/11
- **開発環境**: Visual Studio 2022
- **センサー**: レプトリノ製6軸力覚センサ
- **センサー用ライブラリ**: `CfsUsb.dll`
  - **注意**: このDLLファイルは本リポジトリには含まれていません。センサーの製造元であるレプトリノ社から公式に提供されるものを入手してください。
- **グラフ描画ツール**: `gnuplot`
  - `wgnuplot.exe`にPATHが通っている必要があります。

### 推奨環境
- **CPU**: Intel Core i5以上またはAMD Ryzen 5以上
- **メモリ**: 8GB以上
- **ディスプレイ**: デュアルモニター推奨（リアルタイムプロット表示用）

## セットアップ・ビルド方法

### 1. リポジトリの準備
```bash
git clone <このリポジトリのURL>
cd CfsGUI
```

### 2. DLLファイルの配置
1. レプトリノ社から入手した`CfsUsb.dll`を準備
2. ビルド後に生成される実行ファイル（例: `x86/Debug/`）と同じフォルダに配置

### 3. ビルド実行
1. `CfsGUI.sln`をVisual Studio 2022で開く
2. プラットフォームを「x86」に設定
3. 「ビルド」→「ソリューションのビルド」を実行

### 4. gnuplotの設定
1. [gnuplot公式サイト](http://www.gnuplot.info/)からダウンロード・インストール
2. `wgnuplot.exe`が環境変数PATHに含まれていることを確認

## 使い方

### 基本操作
1. **アプリケーション起動**: `CfsGUI.exe`を実行
2. **計測開始**: 「計測開始」ボタンをクリック
3. **リアルタイム監視**: 「リアルタイムプロット」ボタンで力・モーメントを別々のウィンドウで表示
4. **計測終了**: 「計測終了」ボタンで記録停止（データが`output`フォルダに自動保存）
5. **事後解析**: 「グラフ表示」ボタンでgnuplotによる高品質グラフを表示

### 出力ファイル
- **タイムスタンプ付きCSV**: `output/sensor_data_YYYYMMDD_HHMMSS.csv`
- **最新データCSV**: `output/sensor_data.csv`（常に最新の計測データで上書き）
- **gnuplotスクリプト**: `output/plot_forces.plt`、`output/plot_moments.plt`

### CSVファイル形式
```csv
Timestamp(ms),Fx,Fy,Fz,Mx,My,Mz
0.0000,0.1234,0.5678,-0.9012,0.0123,-0.0456,0.0789
1.2345,0.1235,0.5679,-0.9013,0.0124,-0.0457,0.0790
...
```

## 高度な設定

### パフォーマンス調整
アプリケーション内で以下のパラメータを調整可能：

```cpp
// CfsGUIDlg.cpp 内の定数
m_dataDecimation = 5;           // データ間引き率（1=全データ、5=1/5）
BUFFER_UPDATE_INTERVAL = 50;    // バッファ更新頻度（ms）
PLOT_UPDATE_INTERVAL = 100;     // 描画更新頻度（ms）
MAX_REALTIME_POINTS = 500;      // リアルタイム表示ポイント数
```

### リアルタイムプロット機能
- **左クリック**: オートスケール ⇔ 固定スケール切り替え
- **右クリック**: 表示チャンネルのON/OFF選択
- **ウィンドウ閉じるボタン**: 非表示（「リアルタイムプロット」ボタンで制御）

## プロジェクト構造

```
CfsGUI/
├── CfsGUI/
│   ├── CfsGUI.cpp              # アプリケーションメイン
│   ├── CfsGUI.h
│   ├── CfsGUIDlg.cpp           # メインダイアログ・計測制御
│   ├── CfsGUIDlg.h
│   ├── RealtimePlotWnd.cpp     # リアルタイムプロット表示
│   ├── RealtimePlotWnd.h
│   ├── SensorDataTypes.h       # 共通データ型定義
│   ├── framework.h
│   ├── pch.h                   # プリコンパイル済みヘッダー
│   ├── resource.h              # リソース定義
│   └── ...
├── README.md
├── LICENSE
└── CfsGUI.sln                  # Visual Studioソリューション
```

## トラブルシューティング

### よくある問題

**Q: アプリケーションが起動時にエラーで終了する**
- A: `CfsUsb.dll`が実行ファイルと同じフォルダにあることを確認してください

**Q: 「ポートのオープンに失敗しました」と表示される**
- A: センサーがPCに正しく接続されているか、他のアプリケーションがセンサーを使用していないか確認してください

**Q: gnuplotグラフが表示されない**
- A: gnuplotがインストールされ、PATHが通っていることを確認してください

**Q: リアルタイムプロットが重い・遅い**
- A: `m_dataDecimation`の値を大きくする（例：10）か、`MAX_REALTIME_POINTS`を小さくしてください

**Q: ダイアログのボタンが見切れている**
- A: Windowsの表示スケール設定を確認し、100%に設定するか、アプリケーションを再起動してください

### ログファイル
アプリケーション内のログウィンドウで動作状況を確認できます。エラーが発生した場合は、ログメッセージを参考にしてください。

## 開発者向け情報

### 技術仕様
- **フレームワーク**: MFC (Microsoft Foundation Classes)
- **描画**: Windows GDI + カスタムプロットウィンドウ
- **スレッド**: 計測用ワーカースレッド + UIタイマー
- **データ形式**: STL containers (std::vector, std::deque)

### アーキテクチャ
1. **計測スレッド**: 最高速度でセンサーデータを取得・記録
2. **バッファ管理**: クリティカルセクションによる安全なデータ共有
3. **UI更新**: タイマーベースの定期的な画面更新
4. **プロット表示**: 独立したウィンドウによる専用表示

## ライセンス

このソフトウェアは [MIT License](LICENSE) の下で公開されています。

## 更新履歴

### v2.0.0
- リアルタイムプロット機能追加
- 力とモーメントの分離表示
- パフォーマンス最適化

### v1.0.0
- 初回リリース
- 基本的なデータ記録・保存機能
- gnuplotによるグラフ表示

## サポート・貢献

バグレポートや機能要望は、GitHubのIssuesページでお知らせください。プルリクエストも歓迎します。

## 謝辞

- レプトリノ株式会社：6軸力覚センサーとSDKの提供
- gnuplotプロジェクト：グラフ描画ツールの提供